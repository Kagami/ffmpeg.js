diff --git a/libavformat/file.c b/libavformat/file.c
index cbdf48de0a..4e833978d1 100644
--- a/libavformat/file.c
+++ b/libavformat/file.c
@@ -41,6 +41,9 @@
 #include "os_support.h"
 #include "url.h"
 
+extern int emscripten_read_async(int fd, unsigned char* buf, int size);
+extern void emscripten_close_async(int fd);
+
 /* Some systems may not have S_ISFIFO */
 #ifndef S_ISFIFO
 #  ifdef S_IFIFO
@@ -140,7 +143,11 @@ static int file_read(URLContext *h, unsigned char *buf, int size)
     FileContext *c = h->priv_data;
     int ret;
     size = FFMIN(size, c->blocksize);
-    ret = read(c->fd, buf, size);
+    if ((c->fd == 3) || (c->fd == 4)) {
+        ret = emscripten_read_async(c->fd, buf, size);
+    } else {
+        ret = read(c->fd, buf, size);
+    }
     if (ret == 0 && c->follow)
         return AVERROR(EAGAIN);
     if (ret == 0)
@@ -218,6 +225,7 @@ static int fd_dup(URLContext *h, int oldfd)
 static int file_close(URLContext *h)
 {
     FileContext *c = h->priv_data;
+    emscripten_close_async(c->fd);
     int ret = close(c->fd);
     return (ret == -1) ? AVERROR(errno) : 0;
 }
